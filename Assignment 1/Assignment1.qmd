---
title: "Assignment 1 - Exploratory Data Analysis"
author: "Hanin Almodaweb"
format: html
theme: journal
embed-resources: true
fig-width: 6
fig-height: 4
---

```{r setup, message=FALSE, echo=FALSE, warning=FALSE}
#install.packages(c("data.table","leaflet"))
library(data.table)
library(dplyr)
library(leaflet)
library(tidyverse)
```

# Assignment Description

We will work with air pollution data from the U.S. Environmental Protection Agency (EPA). The EPA has a national monitoring network of air pollution sites that The primary question you will answer is whether daily concentrations of PM$_{2.5}$ (particulate matter air pollution with aerodynamic diameter less than 2.5 $\mu$m) have decreased in California over the last 20 years (from 2002 to 2022).

# Steps

1. Given the formulated question from the assignment description, you will now conduct EDA Checklist items 2-4. First, download 2002 and 2022 data for all sites in California from the [EPA Air Quality Data website](https://www.epa.gov/outdoor-air-quality-data/download-daily-data). Read in the data using `data.table()`. For each of the two datasets, check the dimensions, headers, footers, variable names and variable types. Check for any data issues, particularly in the key variable we are analyzing. Make sure you write up a summary of all of your findings.

```{r}
# reading data into R
EPA2002 <- data.table::fread("/Users/neens/Downloads/ad_viz_plotval_data.csv")
EPA2022 <- data.table::fread("/Users/neens/Downloads/ad_viz_plotval_data-2.csv")

# checking dimensions, headers, footers for the 2002 dataset
dim(EPA2002)
head(EPA2002)
tail(EPA2002)

# checking dimensions, headers, footers for the 2022 dataset
dim(EPA2022)
head(EPA2022)
tail(EPA2022)

# checking variable names and variable types for the 2002 dataset
str(EPA2002)

# checking variable names and variable types for the 2022 dataset
str(EPA2022)

# checking for data issues in both datasets 
# key variables
summary(EPA2002)
summary(EPA2022)

# missing values
# Check for any missing data in EPA2002 and EPA2022
anyNA(EPA2002)
anyNA(EPA2022)
```

## Summary of Findings


2. Combine the two years of data into one data frame. Use the Date variable to create a new column for year, which will serve as an identifier. Change the names of the key variables so that they are easier to refer to in your code.

```{r} 
# convert date to date format
EPA2002$Date <- as.Date(EPA2002$Date, format = "%m/%d/%Y")
EPA2022$Date <- as.Date(EPA2022$Date, format = "%m/%d/%Y")

# create a 'Year' column from the date
EPA2002$Year <- format(EPA2002$Date, "%Y")
EPA2022$Year <- format(EPA2022$Date, "%Y")

# rename the columns of key variables
setnames(EPA2002, old = c("Daily Mean PM2.5 Concentration", "Daily AQI Value", 
                          "Site ID", "Site Latitude", "Site Longitude"), 
                 new = c("PM2_5", "AQI", "Site_ID", "Latitude", "Longitude"))

setnames(EPA2022, old = c("Daily Mean PM2.5 Concentration", "Daily AQI Value", 
                          "Site ID", "Site Latitude", "Site Longitude"), 
                 new = c("PM2_5", "AQI", "Site_ID", "Latitude", "Longitude"))

# combine the two datasets
EPA_combined <- rbind(EPA2002, EPA2022, fill = TRUE)

# checking the new dataset
summary(EPA_combined)
head(EPA_combined)
tail(EPA_combined)
```

3. Create a basic map in leaflet() that shows the locations of the sites (make sure to use different colors for each year). Summarize the spatial distribution of the monitoring sites.

```{r}
# ensure the data is in the correct format
EPA_combined$Year <- as.numeric(EPA_combined$Year)

# define a color palette for the years (2002 and 2022)
palette <- colorFactor(palette = c("coral", "pink"), domain = EPA_combined$Year)

# create the leaflet map
leaflet(EPA_combined) %>%
  addTiles() %>%  # Add default OpenStreetMap tiles
  addCircleMarkers(
    ~Longitude, ~Latitude,  # Set the longitude and latitude
    color = ~palette(Year), # Use different colors for each year
    popup = ~paste("Site ID:", Site_ID, "<br>", 
                   "Year:", Year, "<br>",
                   "PM2.5:", PM2_5, "<br>",
                   "AQI:", AQI),  # Popup information
    radius = 5, fillOpacity = 0.8, stroke = FALSE
  ) %>%
  addLegend(
    "bottomright", 
    pal = palette, 
    values = ~Year, 
    title = "Monitoring Year",
    opacity = 1
  )
```

## Summary of the spatial distribution of the monitoring sites

4. Check for any missing or implausible values of PM$_{2.5}$ in the combined dataset. Explore the proportions of each and provide a summary of any temporal patterns you see in these observations.

```{r EDIT}
# check for missing values in PM2.5
missing_PM25 <- EPA_combined[is.na(PM2_5), .N]

# check for implausible values (e.g., negative values or values above 500)
implausible_PM25 <- EPA_combined[PM2_5 < 0 | PM2_5 > 500, .N]

# total number of observations
total_obs <- nrow(EPA_combined)

# calculate proportions of missing and implausible values
prop_missing <- missing_PM25 / total_obs
prop_implausible <- implausible_PM25 / total_obs

# summary of findings
cat("Total Observations:", total_obs, "\n")
cat("Missing PM2.5 Values:", missing_PM25, "(", round(prop_missing * 100, 2), "% )\n")
cat("Implausible PM2.5 Values:", implausible_PM25, "(", round(prop_implausible * 100, 2), "% )\n")

# explore temporal patterns in missing and implausible values
missing_by_year <- EPA_combined[is.na(PM2_5), .N, by = Year]
implausible_by_year <- EPA_combined[PM2_5 < 0 | PM2_5 > 500, .N, by = Year]

# display the missing and implausible values by year
missing_by_year
implausible_by_year
```

## Summary of temporal patterns

5. Explore the main question of interest at three different spatial levels. Create exploratory plots (e.g. boxplots, histograms, line plots) and summary statistics that best suit each level of data. Be sure to write up explanations of what you observe in these data.
    - state
```{r EDIT}

```

## Summary of observations


    - county
```{r EDIT}

```

## Summary of observations


    - sites in Los Angeles
```{r EDIT}

```

## Summary of observations


  
